<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Career-AI: Resume Analyzer & Job Matcher</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.16/mammoth.browser.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease;
        }
        .card:hover {
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            transform: translateY(-2px);
        }
        .spinner {
            border-top-color: #4f46e5;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-out {
            animation: fadeOut 0.5s ease-in-out forwards;
        }
        @keyframes fadeOut {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0; transform: scale(0.95); height: 0; margin-bottom: 0; padding: 0; border: 0; }
        }
        .btn-action {
            transition: all 0.2s ease;
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="text-2xl font-bold text-gray-800">
                <span class="text-indigo-600">Career</span>-AI
            </div>
            <div>
                <a href="#results-section" class="text-gray-600 hover:text-indigo-600 px-3 py-2">Job Matches</a>
                <a href="#saved-jobs-section" class="text-gray-600 hover:text-indigo-600 px-3 py-2">Saved Jobs</a>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-12">

        <!-- Hero Section -->
        <section class="text-center mb-16">
            <h1 class="text-4xl md:text-5xl font-extrabold mb-4">Find Your Dream Job, Faster.</h1>
            <p class="text-lg text-gray-600 mb-8 max-w-2xl mx-auto">Upload your resume and let our AI analyze your skills to match you with the perfect opportunities.</p>
            <div class="flex justify-center">
                <label for="resume-upload" class="cursor-pointer bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg shadow-lg hover:bg-indigo-700 transition-transform transform hover:scale-105">
                    Upload Your Resume
                </label>
                <input type="file" id="resume-upload" class="hidden" accept=".pdf,.doc,.docx,.txt">
            </div>
             <p id="file-name" class="mt-4 text-sm text-gray-500"></p>
        </section>
        
        <!-- Loading Spinner -->
        <div id="loading-spinner" class="hidden text-center my-16">
            <div class="spinner w-16 h-16 border-4 border-gray-200 rounded-full mx-auto"></div>
            <p class="mt-4 text-lg font-semibold text-gray-700">Analyzing your resume...</p>
        </div>

        <!-- Message Box -->
        <div id="message-box" class="hidden card p-4 my-8 max-w-2xl mx-auto text-center">
            <p id="message-text"></p>
        </div>

        <!-- Main Results Area -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Column 1: Resume Analysis & Saved Jobs -->
            <div class="lg:col-span-1 space-y-8">
                <!-- Resume Analysis -->
                <div id="analysis-section" class="hidden space-y-8">
                    <div class="card p-6 fade-in">
                        <h3 class="text-2xl font-bold mb-4 border-b pb-2">Resume Analysis</h3>
                        <div>
                            <h4 class="font-semibold text-lg mb-2">Extracted Keywords & Skills</h4>
                            <div id="keywords-list" class="flex flex-wrap gap-2"></div>
                        </div>
                    </div>
                     <div class="card p-6 fade-in" style="animation-delay: 0.1s;">
                        <h4 class="font-semibold text-lg mb-2">Action Verb Score</h4>
                        <div class="flex items-center">
                            <div id="verb-score" class="text-3xl font-bold text-indigo-600 mr-3">0</div>
                            <div class="text-gray-600">Strong action verbs found.</div>
                        </div>
                        <p class="text-sm text-gray-500 mt-2">Verbs like "Managed", "Developed", "Led" make your resume stand out.</p>
                    </div>
                </div>
                <!-- Saved Jobs Section -->
                <div id="saved-jobs-section" class="hidden space-y-6">
                    <h2 class="text-3xl font-bold">Saved Jobs</h2>
                    <div id="saved-jobs-list" class="space-y-4">
                        <!-- Saved jobs will be injected here -->
                    </div>
                </div>
            </div>

            <!-- Column 2: Job Matches -->
            <div id="results-section" class="hidden lg:col-span-2 space-y-6">
                <h2 class="text-3xl font-bold text-center lg:text-left">Top Job Matches</h2>
                <div id="job-matches-list" class="space-y-6">
                    <!-- Job match cards will be injected here -->
                </div>
            </div>
        </div>
    </main>

    <script>
        // --- CONFIGURATION & MOCK DATA ---

        // A predefined list of keywords to look for in the resume.
        const KEY_SKILLS = [
            'Python', 'JavaScript', 'React', 'Node.js', 'Java', 'C++', 'SQL', 'NoSQL', 'MongoDB', 'PostgreSQL',
            'AWS', 'Azure', 'GCP', 'Docker', 'Kubernetes', 'CI/CD', 'Jenkins', 'Git', 'Agile', 'Scrum',
            'Data Analysis', 'Machine Learning', 'AI', 'Deep Learning', 'TensorFlow', 'PyTorch', 'Pandas', 'NumPy',
            'Project Management', 'Product Management', 'Leadership', 'Communication', 'Teamwork', 'Problem Solving',
            'Marketing', 'SEO', 'SEM', 'Content Creation', 'Sales', 'Business Development'
        ];

        // A list of strong action verbs to score the resume.
        const ACTION_VERBS = [
            'managed', 'led', 'developed', 'created', 'implemented', 'launched', 'drove', 'increased', 'improved',
            'optimized', 'architected', 'designed', 'negotiated', 'mentored', 'trained', 'achieved', 'delivered'
        ];

        // A mock database of job listings with new fields.
        const JOB_LISTINGS = [
            {
                id: 1,
                title: 'Senior Frontend Developer',
                company: 'Innovate Inc.',
                location: 'San Francisco, CA',
                posted_on: '3 days ago',
                source: 'LinkedIn',
                source_url: 'https://www.linkedin.com/jobs/',
                source_icon_svg: `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>`,
                keywords: ['React', 'JavaScript', 'Node.js', 'CI/CD', 'Agile', 'Teamwork'],
                description: 'Join our innovative team to build next-generation user interfaces with React and modern web technologies.'
            },
            {
                id: 2,
                title: 'Cloud Data Engineer',
                company: 'DataStream Corp.',
                location: 'New York, NY',
                posted_on: '1 day ago',
                source: 'Indeed',
                source_url: 'https://www.indeed.com/jobs',
                source_icon_svg: `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24"><path d="M20.33,3.67A2.021,2.021,0,0,0,18.31,2H5.69A2.021,2.021,0,0,0,3.67,3.67V20.33A2.021,2.021,0,0,0,5.69,22H18.31a2.021,2.021,0,0,0,2.02-2.02ZM9.72,18.28H6.53V9.85H9.72Zm-1.6-9.54a1.8,1.8,0,1,1,1.8-1.8A1.8,1.8,0,0,1,8.12,8.74Zm9.76,9.54H14.7V14.15c0-1-.36-1.65-1.23-1.65a1.33,1.33,0,0,0-1.24,1v4.74H9.05V9.85h3.18v1.47h.04a3.44,3.44,0,0,1,3.1-1.6c3.31,0,3.92,2.18,3.92,5Z"/></svg>`,
                keywords: ['Python', 'SQL', 'AWS', 'PostgreSQL', 'Data Analysis', 'Docker'],
                description: 'We are looking for a data engineer to build and maintain our cloud-based data pipelines on AWS.'
            },
            {
                id: 3,
                title: 'AI/ML Research Scientist',
                company: 'FutureAI Labs',
                location: 'Boston, MA',
                posted_on: '5 days ago',
                source: 'Company Site',
                source_url: '#',
                source_icon_svg: `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9V3m0 18a9 9 0 009-9m-9 9a9 9 0 00-9-9" /></svg>`,
                keywords: ['Python', 'Machine Learning', 'Deep Learning', 'TensorFlow', 'PyTorch', 'AI', 'Research'],
                description: 'Push the boundaries of artificial intelligence. Requires a PhD or equivalent research experience.'
            },
            {
                id: 4,
                title: 'Product Manager',
                company: 'Synergy Solutions',
                location: 'Austin, TX',
                posted_on: '1 week ago',
                source: 'LinkedIn',
                source_url: 'https://www.linkedin.com/jobs/',
                source_icon_svg: `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>`,
                keywords: ['Product Management', 'Agile', 'Scrum', 'Leadership', 'Communication', 'Problem Solving'],
                description: 'Define product vision, strategy, and roadmap for our market-leading SaaS platform.'
            },
            {
                id: 5,
                title: 'Junior Java Developer',
                company: 'Legacy Systems Ltd.',
                location: 'Chicago, IL',
                posted_on: '2 days ago',
                source: 'Company Site',
                source_url: '#',
                source_icon_svg: `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9V3m0 18a9 9 0 009-9m-9 9a9 9 0 00-9-9" /></svg>`,
                keywords: ['Java', 'SQL', 'Git', 'Problem Solving'],
                description: 'An exciting opportunity for a recent graduate to start their career in software development with Java.'
            }
        ];

        // --- STATE MANAGEMENT ---
        let jobInteractionState = {}; // Stores 'saved' or 'dismissed' status by job ID

        // --- DOM ELEMENT REFERENCES ---
        const resumeUploadInput = document.getElementById('resume-upload');
        const fileNameDisplay = document.getElementById('file-name');
        const loadingSpinner = document.getElementById('loading-spinner');
        const analysisSection = document.getElementById('analysis-section');
        const resultsSection = document.getElementById('results-section');
        const keywordsList = document.getElementById('keywords-list');
        const verbScoreDisplay = document.getElementById('verb-score');
        const jobMatchesList = document.getElementById('job-matches-list');
        const savedJobsSection = document.getElementById('saved-jobs-section');
        const savedJobsList = document.getElementById('saved-jobs-list');
        const messageBox = document.getElementById('message-box');
        const messageText = document.getElementById('message-text');

        // --- EVENT LISTENERS ---
        resumeUploadInput.addEventListener('change', handleFileUpload);
        jobMatchesList.addEventListener('click', handleJobCardAction);
        savedJobsList.addEventListener('click', handleSavedJobAction);
        
        // --- FUNCTIONS ---

        /**
         * Handles the file upload event.
         */
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            fileNameDisplay.textContent = `Selected file: ${file.name}`;
            showLoading(true);
            hideMessage();
            resultsSection.classList.add('hidden');
            analysisSection.classList.add('hidden');
            
            readResume(file)
                .then(text => {
                    if(!text || text.trim() === '') throw new Error("Could not extract any text. Please try a different file.");
                    analyzeAndMatch(text);
                })
                .catch(error => {
                    console.error("Error processing resume:", error);
                    showMessage(`Error: ${error.message}`);
                    showLoading(false);
                });
        }

        /**
         * Reads the text content from the uploaded file.
         */
        function readResume(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                const fileName = file.name.toLowerCase();

                if (fileName.endsWith('.pdf')) {
                    reader.onload = event => {
                        pdfjsLib.getDocument({ data: event.target.result }).promise.then(pdf => {
                            let text = '';
                            const pages = Array.from({length: pdf.numPages}, (_, i) => i + 1);
                            return Promise.all(pages.map(pageNum => 
                                pdf.getPage(pageNum).then(page => 
                                    page.getTextContent().then(textContent => 
                                        textContent.items.map(item => item.str).join(' ')
                                    )
                                )
                            )).then(pageTexts => resolve(pageTexts.join('\n\n')));
                        }).catch(reject);
                    };
                    reader.readAsArrayBuffer(file);
                } else if (fileName.endsWith('.docx')) {
                     reader.onload = event => {
                        mammoth.extractRawText({ arrayBuffer: event.target.result })
                            .then(result => resolve(result.value))
                            .catch(reject);
                    };
                    reader.readAsArrayBuffer(file);
                } else if (fileName.endsWith('.txt')) {
                    reader.onload = event => resolve(event.target.result);
                    reader.readAsText(file);
                } else {
                    reject(new Error('Unsupported file type. Please upload a PDF, DOCX, or TXT file.'));
                }
            });
        }
        
        /**
         * Main function to orchestrate the analysis and matching process.
         */
        function analyzeAndMatch(resumeText) {
            const lowerCaseText = resumeText.toLowerCase();
            
            const foundSkills = extractKeywords(lowerCaseText, KEY_SKILLS);
            const verbCount = countActionVerbs(lowerCaseText, ACTION_VERBS);
            const matches = findJobMatches(foundSkills);

            displayAnalysisResults(foundSkills, verbCount);
            displayJobMatches(matches, foundSkills);

            showLoading(false);
            resultsSection.classList.remove('hidden');
            analysisSection.classList.remove('hidden');
        }

        /**
         * Extracts keywords from text.
         */
        function extractKeywords(text, keywords) {
            return keywords.filter(keyword => new RegExp(`\\b${keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}\\b`, 'i').test(text));
        }

        /**
         * Counts the occurrences of action verbs in the text.
         */
        function countActionVerbs(text, verbs) {
            return verbs.filter(verb => new RegExp(`\\b${verb}\\b`, 'i').test(text)).length;
        }

        /**
         * Finds and scores job matches based on skill overlap.
         */
        function findJobMatches(resumeSkills) {
            return JOB_LISTINGS.map(job => {
                const matchedSkills = job.keywords.filter(skill => resumeSkills.includes(skill));
                const score = job.keywords.length > 0 ? (matchedSkills.length / job.keywords.length) * 100 : 0;
                return { ...job, score: Math.round(score), matchedSkills };
            })
            .filter(job => job.score > 0)
            .sort((a, b) => b.score - a.score);
        }

        /**
         * Displays the resume analysis results in the UI.
         */
        function displayAnalysisResults(skills, verbCount) {
            keywordsList.innerHTML = skills.length > 0
                ? skills.map(skill => `<span class="bg-indigo-100 text-indigo-800 text-sm font-medium px-3 py-1 rounded-full">${skill}</span>`).join('')
                : '<p class="text-gray-500">No specific skills found.</p>';
            verbScoreDisplay.textContent = verbCount;
        }

        /**
         * Renders the job match cards in the UI.
         */
        function displayJobMatches(matches, resumeSkills) {
            const visibleMatches = matches.filter(job => jobInteractionState[job.id] !== 'dismissed');

            if (visibleMatches.length === 0) {
                jobMatchesList.innerHTML = `<div class="card p-6 text-center"><p class="text-gray-600">No new job matches found. Try updating your resume or check your saved jobs.</p></div>`;
                return;
            }

            jobMatchesList.innerHTML = visibleMatches.map((job, index) => {
                const skillGaps = job.keywords.filter(skill => !resumeSkills.includes(skill));
                const animationDelay = (index * 0.1) + 0.2;
                const isSaved = jobInteractionState[job.id] === 'saved';
                
                return `
                    <div class="card p-6 fade-in" data-job-id="${job.id}" style="animation-delay: ${animationDelay}s;">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <h3 class="text-xl font-bold text-indigo-700">${job.title}</h3>
                                <p class="text-md text-gray-600">${job.company} - ${job.location}</p>
                            </div>
                            <div class="flex items-center bg-green-100 text-green-800 font-bold text-lg px-4 py-2 rounded-full">
                                ${job.score}% <span class="ml-1 font-medium">Match</span>
                            </div>
                        </div>
                        <div class="flex items-center text-sm text-gray-500 mb-4">
                            <span>Posted: ${job.posted_on}</span>
                            <span class="mx-2">|</span>
                            <a href="${job.source_url}" target="_blank" class="flex items-center gap-1.5 hover:text-indigo-600">
                                ${job.source_icon_svg}
                                <span>${job.source}</span>
                            </a>
                        </div>
                        <p class="text-gray-700 mb-4">${job.description}</p>
                        <div class="border-t pt-4">
                            <h5 class="font-semibold mb-2">Skill Alignment</h5>
                            <div class="mb-3">
                                <p class="text-sm font-medium text-green-700 mb-1">Your Matching Skills:</p>
                                <div class="flex flex-wrap gap-2">
                                    ${job.matchedSkills.length > 0 ? job.matchedSkills.map(skill => `<span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-1 rounded-full">${skill}</span>`).join('') : '<span class="text-xs text-gray-500">None</span>'}
                                </div>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-red-700 mb-1">Skills to Develop:</p>
                                <div class="flex flex-wrap gap-2">
                                    ${skillGaps.length > 0 ? skillGaps.map(skill => `<span class="bg-red-100 text-red-800 text-xs font-medium px-2.5 py-1 rounded-full">${skill}</span>`).join('') : '<span class="text-xs text-gray-500">None! It\'s a perfect match.</span>'}
                                </div>
                            </div>
                        </div>
                        <div class="mt-6 flex justify-end gap-3">
                            <button class="btn-action bg-gray-200 text-gray-700 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300" data-action="dismiss">Dismiss</button>
                            <button class="btn-action bg-white border border-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-lg hover:bg-gray-100" data-action="save" ${isSaved ? 'disabled' : ''}>
                                ${isSaved ? 'Saved ✔' : 'Save for Later'}
                            </button>
                            <a href="${job.source_url}" target="_blank" class="btn-action bg-indigo-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-indigo-700 inline-block">Apply Now</a>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        /**
         * Handles clicks on the Save or Dismiss buttons on job cards.
         */
        function handleJobCardAction(event) {
            const button = event.target.closest('button[data-action]');
            if (!button) return;

            const card = button.closest('.card[data-job-id]');
            const jobId = card.dataset.jobId;
            const action = button.dataset.action;

            if (action === 'dismiss') {
                jobInteractionState[jobId] = 'dismissed';
                card.classList.add('fade-out');
                // The element removes itself from flow via animation `forwards`
            } else if (action === 'save') {
                jobInteractionState[jobId] = 'saved';
                button.textContent = 'Saved ✔';
                button.disabled = true;
                updateSavedJobsList();
            }
        }

        /**
         * Updates the list of saved jobs in the UI.
         */
        function updateSavedJobsList() {
            const savedJobs = JOB_LISTINGS.filter(job => jobInteractionState[job.id] === 'saved');
            
            if (savedJobs.length > 0) {
                savedJobsSection.classList.remove('hidden');
            } else {
                savedJobsSection.classList.add('hidden');
            }

            savedJobsList.innerHTML = savedJobs.map(job => `
                <div class="card p-4 fade-in" data-job-id="${job.id}">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-bold text-indigo-700">${job.title}</p>
                            <p class="text-sm text-gray-600">${job.company}</p>
                        </div>
                        <button class="text-red-500 hover:text-red-700 font-semibold" data-action="remove-saved">Remove</button>
                    </div>
                </div>
            `).join('');
        }

        /**
         * Handles the removal of a job from the saved list.
         */
        function handleSavedJobAction(event) {
            const button = event.target.closest('button[data-action="remove-saved"]');
            if (!button) return;

            const card = button.closest('.card[data-job-id]');
            const jobId = card.dataset.jobId;

            // Update state
            delete jobInteractionState[jobId];
            
            // Re-render saved jobs list
            updateSavedJobsList();

            // Find the original card in the main list and reset its "Save" button
            const originalCard = jobMatchesList.querySelector(`.card[data-job-id="${jobId}"]`);
            if (originalCard) {
                const saveButton = originalCard.querySelector('button[data-action="save"]');
                saveButton.textContent = 'Save for Later';
                saveButton.disabled = false;
            }
        }

        /**
         * UI utility functions
         */
        function showLoading(isLoading) { loadingSpinner.classList.toggle('hidden', !isLoading); }
        function showMessage(text) { messageText.textContent = text; messageBox.classList.remove('hidden'); }
        function hideMessage() { messageBox.classList.add('hidden'); }

    </script>
</body>
</html>
